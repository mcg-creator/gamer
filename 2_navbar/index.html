<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ROG Ally Demo</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <div id="game-container">
      <div id="windows-shell">
        <div id="app-container">
          
          <!-- Top Navigation (inside app-container) -->
          <nav id="top-nav"></nav>
          
          <!-- App Content -->
          <main id="content">Games</main>

        </div>
      </div>
    </div>
  </div>
  
  <script>
    const tabs = [
      "games", "apps", "friends", "gallery", "notifications", "settings", "copilot"
    ];

    let selectedIndex = 0;
    const nav = document.getElementById("top-nav");
    const content = document.getElementById("content");

    function renderNav() {
      nav.innerHTML = "";
      tabs.forEach((tab, i) => {
        const btn = document.createElement("button");
        btn.className = "nav-item" + (i === selectedIndex ? " is-active" : "");
        btn.dataset.index = i;

        // Choose correct image
        const state = (i === selectedIndex) ? "active" : "default";
        const img = document.createElement("img");
        img.src = `assets/nav/${tab}_${state}.png`;
        img.alt = tab;
        btn.appendChild(img);

        btn.addEventListener("mouseenter", () => {
          img.src = `assets/nav/${tab}_active.png`;
        });
        btn.addEventListener("mouseleave", () => {
          img.src = `assets/nav/${tab}_${i === selectedIndex ? "active" : "default"}.png`;
        });
        btn.addEventListener("click", () => selectTab(i));

        nav.appendChild(btn);
      });

      // Update content immediately
      content.textContent = tabs[selectedIndex].charAt(0).toUpperCase() + tabs[selectedIndex].slice(1);
    }

    function selectTab(i) {
      selectedIndex = i;
      renderNav();
    }

    // Keyboard support
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") {
        selectedIndex = (selectedIndex + 1) % tabs.length;
        renderNav();
        e.preventDefault();
      } else if (e.key === "ArrowLeft") {
        selectedIndex = (selectedIndex - 1 + tabs.length) % tabs.length;
        renderNav();
        e.preventDefault();
      } else if (e.key === "Enter") {
        selectTab(selectedIndex);
      } 
      // Remove zoom control on 'D' key or 'A' button press
      else if (e.key === "d") {
        e.preventDefault(); // Prevent zoom control
      }
    });

    // Enhanced Gamepad support
    function handleGamepadInput() {
      const gamepads = navigator.getGamepads();
      if (!gamepads) return;

      const gp = gamepads[0]; // Assume single controller for simplicity
      if (!gp) return;

      // Check axes for joystick movement
      if (gp.axes[0] > 0.5) { // Right movement
        selectedIndex = (selectedIndex + 1) % tabs.length;
        renderNav();
      } else if (gp.axes[0] < -0.5) { // Left movement
        selectedIndex = (selectedIndex - 1 + tabs.length) % tabs.length;
        renderNav();
      } else if (gp.axes[1] > 0.5 || gp.axes[1] < -0.5) {
        // Vertical movement ignored for navigation
      }

      // Check buttons for D-pad movement
      if (gp.buttons[15]?.pressed) { // D-pad right
        selectedIndex = (selectedIndex + 1) % tabs.length;
        renderNav();
      } else if (gp.buttons[14]?.pressed) { // D-pad left
        selectedIndex = (selectedIndex - 1 + tabs.length) % tabs.length;
        renderNav();
      } else if (gp.buttons[0]?.pressed) { // A button
        selectTab(selectedIndex);
      }
    }

    // Poll gamepad input
    setInterval(handleGamepadInput, 100);

    renderNav();
  </script>

  <script src="gamepad.js"></script>
  <script src="keyboard.js"></script>
  <script src="input.js"></script>
  <script src="main.js"></script>
</body>
</html>
